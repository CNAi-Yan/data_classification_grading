spring:
  application:
    name: sensitive-data-detector
  
  # Kafka配置 - 生产环境使用集群Kafka
  kafka:
    bootstrap-servers: kafka1:9092,kafka2:9092,kafka3:9092
    consumer:
      group-id: sensitive-data-detector-group-prod
      auto-offset-reset: latest
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      enable-auto-commit: false
      auto-commit-interval: 1000
      max-poll-records: 500
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.StringSerializer
      acks: all
      retries: 3
      batch-size: 16384
      linger-ms: 1
      buffer-memory: 33554432
  
  # Redis配置 - 生产环境使用Redis集群
  redis:
    cluster:
      nodes: redis1:6379,redis2:6379,redis3:6379,redis4:6379,redis5:6379,redis6:6379
      max-redirects: 3
    database: 0
    timeout: 3000ms
    lettuce:
      pool:
        max-active: 200
        max-idle: 50
        min-idle: 20
        max-wait: 1000ms
  
  # 缓存配置 - 生产环境更大的缓存容量和更长的过期时间
  cache:
    caffeine:
      spec: maximumSize=100000,expireAfterWrite=30m
  
  # 服务注册与发现配置 - 生产环境根据实际情况启用
  cloud:
    consul:
      enabled: false
    config:
      enabled: false
    gateway:
      enabled: false
  
  # 数据库配置 - 生产环境使用MySQL
  datasource:
    url: jdbc:mysql://mysql:3306/sensitive_data?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
    driver-class-name: com.mysql.cj.jdbc.Driver
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:password}
    hikari:
      minimum-idle: 10
      maximum-pool-size: 100
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      connection-test-query: SELECT 1
  
  # JPA配置 - 生产环境禁用SQL显示，使用更安全的DDL策略
  jpa:
    database-platform: org.hibernate.dialect.MySQL8Dialect
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate.format_sql: false
      hibernate.generate_statistics: false
      hibernate.cache.use_second_level_cache: false
      hibernate.cache.use_query_cache: false

# 服务端口 - 生产环境使用8080
server:
  port: 8080
  error:
    include-stacktrace: never
  tomcat:
    max-threads: 200
    min-spare-threads: 20
    connection-timeout: 30000

# 网关配置 - 禁用
spring.cloud.gateway:
  enabled: false

# 限流配置 - 生产环境更严格的限流
resilience4j:
  ratelimiter:
    instances:
      sensitiveDataDetector:
        limitForPeriod: 5000
        limitRefreshPeriod: 1s
        timeoutDuration: 500ms
  
  circuitbreaker:
    instances:
      sensitiveDataDetector:
        registerHealthIndicator: true
        slidingWindowSize: 100
        minimumNumberOfCalls: 10
        permittedNumberOfCallsInHalfOpenState: 5
        automaticTransitionFromOpenToHalfOpenEnabled: true
        waitDurationInOpenState: 60s
        failureRateThreshold: 30

# 性能监控配置 - 生产环境只暴露必要的端点
management:
  endpoints:
    web:
      exposure:
        include: health,metrics,prometheus
  metrics:
    export:
      prometheus:
        enabled: true
  endpoint:
    health:
      show-details: when_authorized

# 应用配置 - 生产环境更高的线程池配置
sensitive:
  data:
    detector:
      # 检测线程池配置
      thread-pool:
        core-size: 20
        max-size: 100
        queue-capacity: 5000
        keep-alive-time: 60
      
      # 规则配置
      rules:
        refresh-interval: 300
        max-rules: 10000
      
      # 缓存配置
      cache:
        enabled: true
        ttl: 3600
        max-size: 1000000
